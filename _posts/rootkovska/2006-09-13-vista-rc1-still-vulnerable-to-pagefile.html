---
layout: post
title: Vista RC1 still vulnerable to the pagefile attack
date: '2006-09-13T18:21:00.001+02:00'
author: Joanna Rutkowska
tags: 
modified_time: '2009-03-25T16:08:46.939+01:00'
blogger_id: tag:blogger.com,1999:blog-24586388.post-115816512027277537
blogger_orig_url: http://theinvisiblethings.blogspot.com/2006/09/vista-rc1-still-vulnerable-to-pagefile.html
---

<img style="float:right; margin:0 0 10px 10px;" src="http://photos1.blogger.com/blogger/5738/2550/320/kernel.jpg" border="0" alt="" />Everybody talks now about the latest Vista RC1 and how ready it is for being shipped to customers. So, I downloaded Vista RC1, Build 5600, x64 edition from MSDN a couple of days ago and gave it a try... To my surprise, it turned out that it's still vulnerable to the signature check bypass attack which I demonstrated nearly 2 months ago at the <a href="http://syscan.org/">SyScan</a> conference...<br /><br />This is not good, because, on the one hand, Vista requires all kernel drivers to be digitally signed (for security reasons), which, in turn requires that all driver developers get (read: buy) an appropriate signing certificate, but on the other hand, malware authors can load their code into kernel for free (without reboot, as I demoed during the talk). <br /><br />The requirement for having all kernel drivers digitally signed raised a lot of controversy when it was announced by Microsoft in January. People argued not only about the fact that paying for a certificate might be unacceptable for e.g. students or open source authors, but also about more "philosophical" aspect that it should be the user's (administrator's) right to load whatever she wants on her own computer, regardless whether somebody has signed it or not.<br /><br />Personally, I think that it's worth to sacrifice a little bit of "freedom" and to spend a few hundred bucks on a certificate in case you're a kernel developer, if this can stop kernel malware from loading. Even though kernel protection can be implemented without PKI, as we can see in case of BSD systems and their <i>securelevel</i> mechanism (although an <a href="http://www.ssi.gouv.fr/fr/sciences/fichiers/lti/cansecwest2006-duflot-paper.pdf">attack </a> has been presented against it a few months ago), I still think that a scheme based on digital signatures is the best solution for end-users. However, it's definitely not worth to sacrifice that all, if there is a known way for bypassing this mechanism... :(<br /><br />It's quite surprising for me that MS still hasn't fixed that problem, especially that the best solution here is also the simplest one to implement. As I described during my talk, it's just enough to... disable kernel mode memory paging. Surly, it would cause a little waste of memory, but according to some Microsoft engineers I spoke to, it would be only around 80MB. This seems very little these days, doesn't it? After all, are people going to run Vista with 256MB or even 512MB of RAM? I'm not ;)<br /><br />Another good solution (and I think it was Brad Spengler of <a href="http://grsecurity.org/">grsecurity</a> who pointed that out to me) would be to calculate a hash for each page which is going to be paged out and then check this hash again on each page which is about to be loaded into memory again. Not that simple as the previous solution, but at least we're saving those 80MB of physical memory :)