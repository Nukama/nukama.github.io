---
layout: post
title: Razor-Thin Hypervisors
date: '2007-10-25T19:55:00.001+02:00'
author: Joanna Rutkowska
tags: 
modified_time: '2009-03-25T16:05:17.923+01:00'
blogger_id: tag:blogger.com,1999:blog-24586388.post-7805915543221342080
blogger_orig_url: http://theinvisiblethings.blogspot.com/2007/10/razor-thin-hypervisors.html
---

I just came back from Stockholm where I attended the <a href="http://virtualizationforum07.com/">Virtualization Forum</a>, and saw several, quite interesting vendor presentations. One that caught my attention was a <a href="http://www.virtualizationforum07.com/res/Dokumentation/vmwarerezab.pdf">talk by VMware</a>, and especially the part that talked about the new ESX 3i hypervisor and presented it as "razor-thin". This "razor-thin" hypervisor will have, according to VMWare, the footprint "of only 32MB".<br /><br />My regular readers might sense that I’m a bit ironic here. Well, 32MB of code is definitely not a "razor-thin" hypervisor in my opinion and it’s not even close to a thin hypervisor... But why am I so picky about it? Is it really that important?<br /><br />Yes, I think so, because the bigger the hypervisor the more chances that there is a bug somewhere out there. And one of the reasons for using virtual machines is to provide isolation. Even if we use virtualization because of business reasons (server consolidation), still we want each VM to be properly isolated, to make sure that if an attackers "gets into" one VM, she will not be able to 0wn all the other VMs on the same hardware… In other words, isolation of VMs, is an extremely important feature.<br /><br />During my presentation I also talked about thin hypervisors. I first referenced a few bugs that were found in various VMMs in the recent months by other researchers (congrats to Rafal Wojtczuk of McAfee for some interestingly looking bugs in VMWare and Microsoft products). I used them as an argument that we should move towards very thin hypervisor architecture, exploiting hardware virtualization extension as much as possible (e.g. Nested Paging/EPT, IOMMU/DEV/NoDMA, etc) and avoiding doing things "in software".<br /><br />Nobody should be really surprised seeing VMMs bugs – after all we have seen so many bugs in OS kernels over years, so no surprise we will see more and more bugs in VMMs, unless we switch to very thin hypervisors, so thin that it would be possible to understand and verify their code by one person. Only then we would be able to talk about security advantage (in terms of isolation) offered by VMMs comparing to traditional OSes.<br /><br />I couldn’t refrain myself from mentioning that the existence of those bugs in popular VMMs clearly shows that having a VMM already installed doesn’t currently prevent from the "Blue Pill threat" – a point often expressed by some virtualization vendors, who notoriously try to diminish the importance of this problem (i.e. the problem of virtualization based malware).<br /><br />I also announced that Invisible Things Lab has just started working with <a href="http://www.phoenix.com/en/Home/default.htm">Phoenix Technologies</a>. Phoenix is the world leader in system firmware, particularly known for providing BIOSes for PCs for almost 25 years, and currently is working on a new product called HyperCore that would be a very thin and lightweight hypervisor for consumer systems. ITL will be helping Phoenix to ensure the security of this product.<br /><br />HyperCore hypervisor will use all the latest hardware virtualization extensions, like e.g. Nested Paging/EPT to minimize the unnecessary complexity and to provide negligible performance impact. For the same reasons, the I/O access will go through almost natively, just like in case of our Blue Pill...<br /><br />Speaking about Blue Pill – Phoenix is also interested in further research on Blue Pill, which will be used as a test bed for trying various ideas – e.g. nested virtualization, which might be adopted in the future versions of HyperCore to allow users to use other commercial VMMs inside their already-virtualized OSes. Blue Pill’s small size and minimal functionality makes it a convenient tool for experimenting. Phoenix will also support <a href="http://bluepillproject.org/">The Blue Pill Project</a> which means that some parts of our research will be available for other researchers (including code)!<br /><br />In case you still feel like having a look into my slides, you can get them <a href="http://invisiblethings.org/pub/Security%20Challenges%20in%20Virtualized%20Enviroments.pdf">here</a>.