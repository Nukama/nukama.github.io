---
layout: post
title: Exploring new lands on Intel CPUs (SINIT code execution hijacking)
date: '2011-12-06T10:48:00.001+01:00'
author: Joanna Rutkowska
tags: 
modified_time: '2012-03-28T11:10:07.825+02:00'
blogger_id: tag:blogger.com,1999:blog-24586388.post-7845092546778053242
blogger_orig_url: http://theinvisiblethings.blogspot.com/2011/12/exploring-new-lands-on-intel-cpus-sinit.html
---

Today we're releasing a new paper where we describe exploiting a bug in Intel SINIT authenticated code module that allows for arbitrary code execution in what we call an “SINIT mode”. So, to the already pretty-well explored “lands” on Intel processors, that include ring 3 (usermode), ring 0 (kernelmode), ring “-1” (VT-x root), and ring “-2” (SMM), we're now adding a new “island”, the SINIT mode, a previously unexplored territory inhabited so far only by the Intel-blessed opcodes. <br /><br />What is really interesting about the attack are the consequences of SINIT mode hijacking, which include ability to bypass Intel TXT, LCP, and also compromise system SMRAM.<br /><br />It's also interesting how difficult was this vulnerability for Intel to patch, as they had to release not only updated SINIT modules, but also updated microcode for all the affected processors, and also work with the BIOS vendors so they release updated BIOSes that would be unconditionally loading this updated microcode (plus provide anti-rollback mechanisms for both the BIOS and microcode). Quite an undertaking...<br /><br />You can get the paper <a href="http://www.invisiblethingslab.com/resources/2011/Attacking_Intel_TXT_via_SINIT_hijacking.pdf">here</a>.<br /><br />Intel also published an advisory yesterday, which can be downloaded from their website <a href="http://security-center.intel.com/advisory.aspx?intelid=INTEL-SA-00030&amp;languageid=en-fr">here</a>. The advisory is peculiar in a few ways, however...<br /><br />First, the advisory (I'm referring to the revision 1.0) never explicitly mentions that the attack allows to bypass TXT launch itself, only that the attack “may compromise certain SINIT ACM functionality, including launch control policy and additionally lead to compromise of System Management Mode (SMM). Intel also recommend to disable TXT altogether in the BIOS, as a preventive measure, in case the user doesn't “actively running Intel® TXT”... This reminds me how various vendors started actively disabling Intel VT-x after certain virtualization rootkits have been demonstrated some 5 years ago, and how many laptops still ship with this technology disabled today (or VT-d at least) to the questionable delight of many users.<br /><br />Second, the advisory assigns only an “Important” rating to this vulnerability, even though <a href="http://security-center.intel.com/advisory.aspx?intelid=INTEL-SA-00021&amp;languageid=en-fr">another Intel advisory</a>, published some two years ago for a problem also reported by us, and which which was strictly a <i>subset</i> of the current vulnerability in terms of powers that it gave to the attacker (in other words the current vulnerability provides the attacker with everything that the previous one did, plus much more), was given a “Critical” rating... This is called evolution, I guess, and I wonder what would be considered critical by Intel these days?<br /><br /><b>UPDATE (Dec 7th, 2011):</b> Intel has just released <a href="http://security-center.intel.com/advisory.aspx?intelid=INTEL-SA-00030&amp;languageid=en-fr">an updated advisory</a> (release 1.1) that now explicitly states that the vulnerability also bypasses Intel TXT.<br /><br />This is the last paper co-authored with Rafal Wojtczuk, who recently decided to try some new things and to leave ITL. Rafal has been the most talented exploit writer I have worked with, and I will surely miss his ingenious insights, such as e.g. how to practically win an absolutely hopeless race condition with ICMP-delivered MSI! But then again, how many times can one break Intel technologies, before getting bored? At the same time ITL is really transforming now into a development company, with all our efforts around Qubes and architecting, rather than on breaking. I wish Rafal all the best with his new endeavors, and thank him for all the excellent contributions he made while working for ITL over the past 3+ years.