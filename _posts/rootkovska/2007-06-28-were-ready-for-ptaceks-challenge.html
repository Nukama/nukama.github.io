---
layout: post
title: We're ready for the Ptacek's challenge!
date: '2007-06-28T13:23:00.001+02:00'
author: Joanna Rutkowska
tags: 
modified_time: '2009-03-25T16:06:10.364+01:00'
blogger_id: tag:blogger.com,1999:blog-24586388.post-4491938186982426867
blogger_orig_url: http://theinvisiblethings.blogspot.com/2007/06/were-ready-for-ptaceks-challenge.html
---

Thomas Ptacek and company just came up with this <a href="http://www.matasano.com/log/895/joanna-we-can-detect-bluepill-let-us-prove-it/">funny challenge</a> to test our Blue Pill rootkit. And, needles to say, the Invisible Things Lab <a href="http://invisiblethingslab.com/about.html">team</a> is ready to take their challenge, however with some additional requirements, that would assure the fairness of the contest.<br /><br />First, we believe that 2 machines are definitely not enough, because the chance of correct guess, using a completely random (read: unreliable) detection method is 50%. Thus we think that the reasonable number is 5 machines. Each of them could be in a state <span style="font-family:courier new;">0</span> or <span style="font-family:courier new;">1</span> (i.e. infected or not). On each of this machines we install two files: <span style="font-family:courier new;">bluepill.exe</span> and <span style="font-family:courier new;">bluepill.sys</span><br /><br />The <span style="font-family:courier new;">.sys</span> file is digitally signed, so it loads without any problem (we could use one of our methods for loading unsigned code on vista that we're planning to demonstrate at BH, but this is not part of the challenge, so we will use the official way).<br /><br />The <span style="font-family:courier new;">bluepill.exe</span> takes one argument which is <span style="font-family:courier new;">0</span> or <span style="font-family:courier new;">1</span>. If it's <span style="font-family:courier new;">1</span> it loads the driver and infects the machines. If it's 0 it also loads the driver, but the driver does not infect the machine.<br /><br />So, on each of the 5 machines we run <span style="font-family:courier new;">bluepill.exe</span> with randomly chosen argument, being <span style="font-family:courier new;">0</span> or <span style="font-family:courier new;">1</span>. We make sure that at least one machine is not infected and that at least one machine is infected.<br /><br />After that the detection team runs their <span style="font-family:courier new;">detector.exe</span> executable on each machine. This program can not take any arguments and must return only one value: <span style="font-family:courier new;">0</span> or <span style="font-family:courier new;">1</span>. It must act autonomously -- no human assistance when interpreting the results.<br /><br />The goal of the detection team is to correctly mark each machine as either being infected (<span style="font-family:courier new;">1</span>) or not (<span style="font-family:courier new;">0</span>). The chance of a blind guess is:<br /><br /><div style="text-align: center;"><span style="font-family:courier new;">1/(2^5-2) = 3%</span><br /></div><br />The detector can not cause system crash or halt the machine -- if it does they lose. The detector can not consume significant amount of CPU time (say > 90%) for more then, say 1 sec. If it does, then it's considered disturbing for the user and thus unpractical.<br /><br />The source code of our rootkit as well as the detector should be provided to the judges at the beginning of the contests. The judges will compile the rootkit and the detector and will copy the resulting binaries to all test machines.<br /><br />After the completion of the contest, regardless of who wins, the sources for both the rootkit and the detector will be published in the Internet -- for educational purpose to allow others to research this subject.<br /><br />Our current Blue Pill has been in the development for only about 2 months (please note that we do not have rights to use the previous version developed for COSEINC) and it is more of a prototype, with primary use for <a href="http://blackhat.com/html/bh-usa-07/train-bh-us-07-jrk.html">our training in Vegas</a>, rather then a "commercial grade rootkit". Obviously we will be discussing all the limitations of this prototype during our training. We believe that we would need about 6 months full-time work by 2 people to turn it into such a commercial grade creature that would win the contest described above. We're ready to do this, but we expect that somebody compensate us for the time spent on this work. We would expect an industry standard fee for this work, which we estimate to be $200 USD per hour per person.<br /><br />If Thomas Ptacek and his colleges are so certain that they found a panacea for virtualization based malware, then I'm sure that they will be able to find sponsors willing to financially support this challenge.<br /><br />As a side note, the description for our <a href="http://blackhat.com/html/bh-usa-07/bh-usa-07-speakers.html#Rutkowska">new talk for Black Hat Vegas</a> has just been published yesterday.