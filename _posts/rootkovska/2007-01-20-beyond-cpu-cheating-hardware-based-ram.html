---
layout: post
title: 'Beyond The CPU: Cheating Hardware Based RAM Forensics'
date: '2007-01-20T13:13:00.001+01:00'
author: Joanna Rutkowska
tags: 
modified_time: '2009-03-25T16:07:58.721+01:00'
thumbnail: http://4.bp.blogspot.com/_Ti3q3Hdvels/RbISDXtmzMI/AAAAAAAAAAk/TlmnJhxXJcs/s72-c/green-board-small.jpg
blogger_id: tag:blogger.com,1999:blog-24586388.post-1453328084371931288
blogger_orig_url: http://theinvisiblethings.blogspot.com/2007/01/beyond-cpu-cheating-hardware-based-ram.html
---

<img style="margin: 0px auto 10px; display: block; text-align: center;" src="http://4.bp.blogspot.com/_Ti3q3Hdvels/RbISDXtmzMI/AAAAAAAAAAk/TlmnJhxXJcs/s400/green-board-small.jpg" alt="" id="BLOGGER_PHOTO_ID_5022096383585733826" border="0" /><br />We all know that any software-based system compromise detector can always be cheated if malware runs at the same privilege level as the detector (usually both run in kernel mode). This is what I call Implementation Specific Attacks (ISA). Because of that, mankind has tried to find some better, more reliable ways for analyzing systems, which would not be subject to interference from malware…<br /><br />And we all know what we’ve come up with as a solution – <i>hardware</i> based devices for obtaining the image of volatile memory (RAM), usually in the form of a PCI card. As far as the PC architecture is concerned, probably the first two papers in this area are those about <a href="http://www.digital-evidence.org/papers/tribble-preprint.pdf">Tribble</a> and <a href="http://www.komoku.com/pubs/USENIX-copilot.pdf">CoPilot</a>. As an alternative to expensive dedicated PCI cards, one can also use a FireWire bus, as it has been described by <a href="http://cansecwest.com/core05/2005-firewire-cansecwest.pdf">Maximillian Dornseif at el.</a>, and later by <a href="http://www.security-assessment.com/files/presentations/ab_firewire_rux2k6-final.pdf">Adam Boileau</a>.<br /><br />The point is: once we get the memory image, we can analyze it for signs of compromises on a trusted machine or we can have the PCI device to do some checks itself (like e.g. CoPilot does).<br /><br />The whole idea behind hardware based RAM acquisition is that the process of reading the memory is using Direct Memory Access (DMA) to read the physical memory. DMA, as the name suggests, does not involve CPU in the process of accessing memory. So, it seems to be a very reliable way for reading the physical memory…<br /><br />But it is not! At least in some cases...<br /><br />Next month, at <a href="http://blackhat.com/html/bh-dc-07/bh-dc-07-speakers.html#Rutkowska">Black Hat DC</a>, I will be demonstrating how to cheat hardware based memory acquisition on AMD based systems. In other words, I will be showing that the image obtained using DMA, can be made different from the real contents of the physical memory as seen by the CPU. Even though the attack is AMD-specific, it <span style="font-style: italic;">does not</span> rely on virtualization extensions. Also, the attack does not require system reboot. Nor does it require soldering ;)<br /><br />I have tested my proof-of-concept code against a FireWire-based method of memory acquisition, using tools from Adam Boileau’s <a href="http://www.security-assessment.com/files/presentations/pythonraw1394-1.0.tar.gz">presentation</a>.<br /><br />I wanted to test it also against some PCI cards, but it turned out, that for an ordinary mortal person like myself, it is virtually impossible to buy a sample of a dedicated PCI card for memory acquisition… E.g. the <a href="http://www.grandideastudio.com/portfolio/index.php?id=1&prod=14">Tribble card</a> is still unavailable for sale, according to its author, even though the prototype has been build in 2003... <a href="http://bbn.com/About_BBN/index.html">BBN</a>, the US company known for doing lots of project for the US government, apparently has <a href="http://www.tswg.gov/tswg/about/2005_TSWG_ReviewBook-ForWeb.pdf">a prototype</a> (see page 45) of something similar to Tribble, but is not willing to discuss any details with somebody who is not involved in a project with the US government... Finally, <a href="http://komoku.com/">Komoku Inc.</a>, whose main customers, according to the website, are also US government agencies, also rejected my inquiry for buying a sample of CoPilot, claiming that the device "is not generally available right now" ;)<br /><br />Anyway, even though I was able to test the attack only against FireWire based method, I’m pretty confident that it will work against all other devices which use DMA to access the physical memory, as the attack itself is very generic.<br /><br />See you in DC!